/***********************************************************
Company Name:
	清华大学无线中心;
Function Name:
	Large_interp;
Function Description:
	;拉格朗日内插
Inputs:
	d_os_sig					   ： 输入信号
	os_sig_len                     ： 输入信号长度
	d_new_idx					   :  内插系数
	new_idx_len                    ： 内插系数长度
	d_factor 小于1上采样,大于1下采样
	d_out_sig					   :  输出信号
	out_sig_len					   ： 输出信号长度
Outputs:
	返回0：正常；
	返回1：输入信号长度超出设定最大值；
	返回2：输入new_idx的长度超出设定最大值；
	返回3：下标值超过输入信号长度

Notes: 
**************************************************************************/
#include "Large_interp1.h"

#define TABLE_SIZE 256

d_type d_new_idx[LARGE_INTERP_NEW_IDX_LEN];

int Large_interp1(d_type d_os_sig_real[], d_type d_os_sig_imag[], int os_sig_len, Air_mid_la_para *p_Air_mid_la_para, d_type *d_out_sig_real, d_type *d_out_sig_imag, int *out_sig_len, d_type *d_out_fracst, int tx_rx_flag)
{
	int i = 0;
	int i_num;
	int i_num_tmp;
	int i_resample_len;
	int new_idx_len;

	d_type d_factor;
	d_type d_frac;
	d_type d_params = 1.0/3;
	d_type d_c0;
	d_type d_tmp1;
	d_type d_tmp2;
	d_type d_c1;
	d_type d_c2;
	d_type d_c3;
	d_type d_mult1;
	d_type d_mult2;
	d_type d_mult3;

	if (os_sig_len > LARGE_INTERP_OS_SIG_LEN)
	{
		return 1;
	}

//	if (new_idx_len > LARGE_INTERP_NEW_IDX_LEN)
//	{
//		return 2;
//	}

	////////////////// added by GAO 20150802
	//Bug
	i_resample_len = floorf(os_sig_len*p_Air_mid_la_para->interp_factor);
	if (tx_rx_flag) d_factor = 1/p_Air_mid_la_para->interp_factor;
	else d_factor = p_Air_mid_la_para->interp_factor;

	for (i=0; i<i_resample_len; i++)
	{
		
		d_new_idx[i]= p_Air_mid_la_para->fracst + (p_Air_mid_la_para->timeo + i + 1)*d_factor;
		if (d_new_idx[i] > (os_sig_len-1))
		{
			new_idx_len = i;
			*d_out_fracst = d_new_idx[i-1] - os_sig_len + 4;
			break;
		}

	}
	
	//printf("new_idx_len %d\n",new_idx_len);
	///////////////////////////////////////

	for (i=0; i<new_idx_len; i++)
	{
		i_num_tmp = floorf(d_new_idx[i]);
		d_frac = d_new_idx[i] - i_num_tmp;
		i_num = i_num_tmp - 1;

		if (i_num > os_sig_len)
		{
			return 3;
		}

		d_c0 = d_os_sig_real[i_num];
		d_tmp1 = d_params * d_os_sig_real[i_num - 1];
		d_tmp2 = d_params * d_os_sig_real[i_num + 2];
		d_c1 = d_os_sig_real[i_num + 1] - d_tmp1 - d_os_sig_real[i_num]/2 - d_tmp2/2;
		d_c2 = (d_os_sig_real[i_num - 1] + d_os_sig_real[i_num + 1])/2 - d_os_sig_real[i_num];
		d_c3 = d_params/2 * (d_os_sig_real[i_num + 2] - d_os_sig_real[i_num - 1]) + (d_os_sig_real[i_num] - d_os_sig_real[i_num + 1])/2;	
		d_mult1 = d_c3 * d_frac;
		d_mult2 = (d_mult1 + d_c2) * d_frac;
		d_mult3 = (d_mult2 + d_c1) * d_frac;
		d_out_sig_real[i] = d_mult3 + d_c0;

		d_c0 = d_os_sig_imag[i_num];
		d_tmp1 = d_params * d_os_sig_imag[i_num - 1];
		d_tmp2 = d_params * d_os_sig_imag[i_num + 2];
		d_c1 = d_os_sig_imag[i_num + 1] - d_tmp1 - d_os_sig_imag[i_num]/2 - d_tmp2/2;
		d_c2 = (d_os_sig_imag[i_num - 1] + d_os_sig_imag[i_num + 1])/2 - d_os_sig_imag[i_num];
		d_c3 = d_params/2 * (d_os_sig_imag[i_num + 2] - d_os_sig_imag[i_num - 1]) + (d_os_sig_imag[i_num] - d_os_sig_imag[i_num + 1])/2;
		d_mult1 = d_c3 * d_frac;
		d_mult2 = (d_mult1 + d_c2) * d_frac;
		d_mult3 = (d_mult2 + d_c1) * d_frac;
		d_out_sig_imag[i] = d_mult3 + d_c0;
	}

	*out_sig_len = new_idx_len;

	return 0;
}

#if TABLE_SIZE == 256

d_type Lagrange_table[256][4] = {
-0.0 , 1.0 , 0.0 , -0.0 , 
-0.00129446387291 , 0.998031646013 , 0.00391384959221 , -0.000651031732559 , 
-0.0025737285614 , 0.996032953262 , 0.00784277915955 , -0.00130200386047 , 
-0.00383785367012 , 0.994004100561 , 0.0117866098881 , -0.0019528567791 , 
-0.00508689880371 , 0.991945266724 , 0.0157451629639 , -0.00260353088379 , 
-0.00632092356682 , 0.989856630564 , 0.019718259573 , -0.0032539665699 , 
-0.00753998756409 , 0.987738370895 , 0.0237057209015 , -0.00390410423279 , 
-0.00874415040016 , 0.985590666533 , 0.0277073681355 , -0.00455388426781 , 
-0.00993347167969 , 0.983413696289 , 0.0317230224609 , -0.00520324707031 , 
-0.0111080110073 , 0.981207638979 , 0.035752505064 , -0.00585213303566 , 
-0.0122678279877 , 0.978972673416 , 0.0397956371307 , -0.0065004825592 , 
-0.0134129822254 , 0.976708978415 , 0.0438522398472 , -0.0071482360363 , 
-0.0145435333252 , 0.974416732788 , 0.0479221343994 , -0.0077953338623 , 
-0.0156595408916 , 0.972096115351 , 0.0520051419735 , -0.00844171643257 , 
-0.0167610645294 , 0.969747304916 , 0.0561010837555 , -0.00908732414246 , 
-0.0178481638432 , 0.967370480299 , 0.0602097809315 , -0.00973209738731 , 
-0.0189208984375 , 0.964965820313 , 0.0643310546875 , -0.0103759765625 , 
-0.0199793279171 , 0.962533503771 , 0.0684647262096 , -0.0110189020634 , 
-0.0210235118866 , 0.960073709488 , 0.072610616684 , -0.0116608142853 , 
-0.0220535099506 , 0.957586616278 , 0.0767685472965 , -0.0123016536236 , 
-0.0230693817139 , 0.955072402954 , 0.0809383392334 , -0.0129413604736 , 
-0.0240711867809 , 0.952531248331 , 0.0851198136806 , -0.0135798752308 , 
-0.0250589847565 , 0.949963331223 , 0.0893127918243 , -0.0142171382904 , 
-0.0260328352451 , 0.947368830442 , 0.0935170948505 , -0.0148530900478 , 
-0.0269927978516 , 0.944747924805 , 0.0977325439453 , -0.0154876708984 , 
-0.0279389321804 , 0.942100793123 , 0.101958960295 , -0.0161208212376 , 
-0.0288712978363 , 0.939427614212 , 0.106196165085 , -0.0167524814606 , 
-0.0297899544239 , 0.936728566885 , 0.110443979502 , -0.0173825919628 , 
-0.0306949615479 , 0.934003829956 , 0.114702224731 , -0.0180110931396 , 
-0.0315863788128 , 0.931253582239 , 0.11897072196 , -0.0186379253864 , 
-0.0324642658234 , 0.928478002548 , 0.123249292374 , -0.0192630290985 , 
-0.0333286821842 , 0.925677269697 , 0.127537757158 , -0.0198863446712 , 
-0.0341796875 , 0.9228515625 , 0.1318359375 , -0.0205078125 , 
-0.0350173413754 , 0.920001059771 , 0.136143654585 , -0.0211273729801 , 
-0.0358417034149 , 0.917125940323 , 0.140460729599 , -0.021744966507 , 
-0.0366528332233 , 0.914226382971 , 0.144786983728 , -0.0223605334759 , 
-0.0374507904053 , 0.911302566528 , 0.149122238159 , -0.0229740142822 , 
-0.0382356345654 , 0.908354669809 , 0.153466314077 , -0.0235853493214 , 
-0.0390074253082 , 0.905382871628 , 0.157819032669 , -0.0241944789886 , 
-0.0397662222385 , 0.902387350798 , 0.16218021512 , -0.0248013436794 , 
-0.0405120849609 , 0.899368286133 , 0.166549682617 , -0.0254058837891 , 
-0.0412450730801 , 0.896325856447 , 0.170927256346 , -0.0260080397129 , 
-0.0419652462006 , 0.893260240555 , 0.175312757492 , -0.0266077518463 , 
-0.0426726639271 , 0.89017161727 , 0.179706007242 , -0.0272049605846 , 
-0.0433673858643 , 0.887060165405 , 0.184106826782 , -0.0277996063232 , 
-0.0440494716167 , 0.883926063776 , 0.188515037298 , -0.0283916294575 , 
-0.0447189807892 , 0.880769491196 , 0.192930459976 , -0.0289809703827 , 
-0.0453759729862 , 0.877590626478 , 0.197352916002 , -0.0295675694942 , 
-0.0460205078125 , 0.874389648438 , 0.201782226563 , -0.0301513671875 , 
-0.0466526448727 , 0.871166735888 , 0.206218212843 , -0.0307323038578 , 
-0.0472724437714 , 0.867922067642 , 0.21066069603 , -0.0313103199005 , 
-0.0478799641132 , 0.864655822515 , 0.215109497309 , -0.031885355711 , 
-0.0484752655029 , 0.861368179321 , 0.219564437866 , -0.0324573516846 , 
-0.0490584075451 , 0.858059316874 , 0.224025338888 , -0.0330262482166 , 
-0.0496294498444 , 0.854729413986 , 0.228492021561 , -0.0335919857025 , 
-0.0501884520054 , 0.851378649473 , 0.23296430707 , -0.0341545045376 , 
-0.0507354736328 , 0.848007202148 , 0.237442016602 , -0.0347137451172 , 
-0.0512705743313 , 0.844615250826 , 0.241924971342 , -0.0352696478367 , 
-0.0517938137054 , 0.841202974319 , 0.246412992477 , -0.0358221530914 , 
-0.0523052513599 , 0.837770551443 , 0.250905901194 , -0.0363712012768 , 
-0.0528049468994 , 0.834318161011 , 0.255403518677 , -0.0369167327881 , 
-0.0532929599285 , 0.830845981836 , 0.259905666113 , -0.0374586880207 , 
-0.0537693500519 , 0.827354192734 , 0.264412164688 , -0.03799700737 , 
-0.0542341768742 , 0.823842972517 , 0.268922835588 , -0.0385316312313 , 
-0.0546875 , 0.8203125 , 0.2734375 , -0.0390625 , 
-0.055129379034 , 0.816762953997 , 0.277955979109 , -0.0395895540714 , 
-0.0555598735809 , 0.813194513321 , 0.282478094101 , -0.0401127338409 , 
-0.0559790432453 , 0.809607356787 , 0.287003666162 , -0.0406319797039 , 
-0.0563869476318 , 0.806001663208 , 0.291532516479 , -0.0411472320557 , 
-0.0567836463451 , 0.802377611399 , 0.296064466238 , -0.0416584312916 , 
-0.0571691989899 , 0.798735380173 , 0.300599336624 , -0.042165517807 , 
-0.0575436651707 , 0.795075148344 , 0.305136948824 , -0.0426684319973 , 
-0.0579071044922 , 0.791397094727 , 0.309677124023 , -0.0431671142578 , 
-0.0582595765591 , 0.787701398134 , 0.314219683409 , -0.0436615049839 , 
-0.058601140976 , 0.783988237381 , 0.318764448166 , -0.0441515445709 , 
-0.0589318573475 , 0.780257791281 , 0.323311239481 , -0.0446371734142 , 
-0.0592517852783 , 0.776510238647 , 0.32785987854 , -0.0451183319092 , 
-0.0595609843731 , 0.772745758295 , 0.332410186529 , -0.0455949604511 , 
-0.0598595142365 , 0.768964529037 , 0.336961984634 , -0.0460669994354 , 
-0.060147434473 , 0.765166729689 , 0.341515094042 , -0.0465343892574 , 
-0.0604248046875 , 0.761352539063 , 0.346069335938 , -0.0469970703125 , 
-0.0606916844845 , 0.757522135973 , 0.350624531507 , -0.047454982996 , 
-0.0609481334686 , 0.753675699234 , 0.355180501938 , -0.0479080677032 , 
-0.0611942112446 , 0.74981340766 , 0.359737068415 , -0.0483562648296 , 
-0.061429977417 , 0.745935440063 , 0.364294052124 , -0.0487995147705 , 
-0.0616554915905 , 0.74204197526 , 0.368851274252 , -0.0492377579212 , 
-0.0618708133698 , 0.738133192062 , 0.373408555984 , -0.0496709346771 , 
-0.0620760023594 , 0.734209269285 , 0.377965718508 , -0.0500989854336 , 
-0.0622711181641 , 0.730270385742 , 0.382522583008 , -0.0505218505859 , 
-0.0624562203884 , 0.726316720247 , 0.387078970671 , -0.0509394705296 , 
-0.0626313686371 , 0.722348451614 , 0.391634702682 , -0.0513517856598 , 
-0.0627966225147 , 0.718365758657 , 0.396189600229 , -0.051758736372 , 
-0.062952041626 , 0.71436882019 , 0.400743484497 , -0.0521602630615 , 
-0.0630976855755 , 0.710357815027 , 0.405296176672 , -0.0525563061237 , 
-0.0632336139679 , 0.706332921982 , 0.40984749794 , -0.052946805954 , 
-0.0633598864079 , 0.702294319868 , 0.414397269487 , -0.0533317029476 , 
-0.0634765625 , 0.6982421875 , 0.4189453125 , -0.0537109375 , 
-0.063583701849 , 0.694176703691 , 0.423491448164 , -0.0540844500065 , 
-0.0636813640594 , 0.690098047256 , 0.428035497665 , -0.0544521808624 , 
-0.063769608736 , 0.686006397009 , 0.43257728219 , -0.0548140704632 , 
-0.0638484954834 , 0.681901931763 , 0.437116622925 , -0.0551700592041 , 
-0.0639180839062 , 0.677784830332 , 0.441653341055 , -0.0555200874805 , 
-0.063978433609 , 0.67365527153 , 0.446187257767 , -0.0558640956879 , 
-0.0640296041965 , 0.669513434172 , 0.450718194246 , -0.0562020242214 , 
-0.0640716552734 , 0.66535949707 , 0.45524597168 , -0.0565338134766 , 
-0.0641046464443 , 0.66119363904 , 0.459770411253 , -0.0568594038486 , 
-0.0641286373138 , 0.657016038895 , 0.464291334152 , -0.057178735733 , 
-0.0641436874866 , 0.652826875448 , 0.468808561563 , -0.0574917495251 , 
-0.0641498565674 , 0.648626327515 , 0.473321914673 , -0.0577983856201 , 
-0.0641472041607 , 0.644414573908 , 0.477831214666 , -0.0580985844135 , 
-0.0641357898712 , 0.640191793442 , 0.48233628273 , -0.0583922863007 , 
-0.0641156733036 , 0.63595816493 , 0.48683694005 , -0.0586794316769 , 
-0.0640869140625 , 0.631713867188 , 0.491333007813 , -0.0589599609375 , 
-0.0640495717525 , 0.627459079027 , 0.495824307203 , -0.0592338144779 , 
-0.0640037059784 , 0.623193979263 , 0.500310659409 , -0.0595009326935 , 
-0.0639493763447 , 0.61891874671 , 0.504791885614 , -0.0597612559795 , 
-0.0638866424561 , 0.614633560181 , 0.509267807007 , -0.0600147247314 , 
-0.0638155639172 , 0.61033859849 , 0.513738244772 , -0.0602612793446 , 
-0.0637362003326 , 0.606034040451 , 0.518203020096 , -0.0605008602142 , 
-0.0636486113071 , 0.601720064878 , 0.522661954165 , -0.0607334077358 , 
-0.0635528564453 , 0.597396850586 , 0.527114868164 , -0.0609588623047 , 
-0.0634489953518 , 0.593064576387 , 0.531561583281 , -0.0611771643162 , 
-0.0633370876312 , 0.588723421097 , 0.5360019207 , -0.0613882541656 , 
-0.0632171928883 , 0.584373563528 , 0.540435701609 , -0.0615920722485 , 
-0.0630893707275 , 0.580015182495 , 0.544862747192 , -0.06178855896 , 
-0.0629536807537 , 0.575648456812 , 0.549282878637 , -0.0619776546955 , 
-0.0628101825714 , 0.571273565292 , 0.55369591713 , -0.0621592998505 , 
-0.0626589357853 , 0.56689068675 , 0.558101683855 , -0.0623334348202 , 
-0.0625 , 0.5625 , 0.5625 , -0.0625 , 
-0.0623334348202 , 0.558101683855 , 0.56689068675 , -0.0626589357853 , 
-0.0621592998505 , 0.55369591713 , 0.571273565292 , -0.0628101825714 , 
-0.0619776546955 , 0.549282878637 , 0.575648456812 , -0.0629536807537 , 
-0.06178855896 , 0.544862747192 , 0.580015182495 , -0.0630893707275 , 
-0.0615920722485 , 0.540435701609 , 0.584373563528 , -0.0632171928883 , 
-0.0613882541656 , 0.5360019207 , 0.588723421097 , -0.0633370876312 , 
-0.0611771643162 , 0.531561583281 , 0.593064576387 , -0.0634489953518 , 
-0.0609588623047 , 0.527114868164 , 0.597396850586 , -0.0635528564453 , 
-0.0607334077358 , 0.522661954165 , 0.601720064878 , -0.0636486113071 , 
-0.0605008602142 , 0.518203020096 , 0.606034040451 , -0.0637362003326 , 
-0.0602612793446 , 0.513738244772 , 0.61033859849 , -0.0638155639172 , 
-0.0600147247314 , 0.509267807007 , 0.614633560181 , -0.0638866424561 , 
-0.0597612559795 , 0.504791885614 , 0.61891874671 , -0.0639493763447 , 
-0.0595009326935 , 0.500310659409 , 0.623193979263 , -0.0640037059784 , 
-0.0592338144779 , 0.495824307203 , 0.627459079027 , -0.0640495717525 , 
-0.0589599609375 , 0.491333007813 , 0.631713867188 , -0.0640869140625 , 
-0.0586794316769 , 0.48683694005 , 0.63595816493 , -0.0641156733036 , 
-0.0583922863007 , 0.48233628273 , 0.640191793442 , -0.0641357898712 , 
-0.0580985844135 , 0.477831214666 , 0.644414573908 , -0.0641472041607 , 
-0.0577983856201 , 0.473321914673 , 0.648626327515 , -0.0641498565674 , 
-0.0574917495251 , 0.468808561563 , 0.652826875448 , -0.0641436874866 , 
-0.057178735733 , 0.464291334152 , 0.657016038895 , -0.0641286373138 , 
-0.0568594038486 , 0.459770411253 , 0.66119363904 , -0.0641046464443 , 
-0.0565338134766 , 0.45524597168 , 0.66535949707 , -0.0640716552734 , 
-0.0562020242214 , 0.450718194246 , 0.669513434172 , -0.0640296041965 , 
-0.0558640956879 , 0.446187257767 , 0.67365527153 , -0.063978433609 , 
-0.0555200874805 , 0.441653341055 , 0.677784830332 , -0.0639180839062 , 
-0.0551700592041 , 0.437116622925 , 0.681901931763 , -0.0638484954834 , 
-0.0548140704632 , 0.43257728219 , 0.686006397009 , -0.063769608736 , 
-0.0544521808624 , 0.428035497665 , 0.690098047256 , -0.0636813640594 , 
-0.0540844500065 , 0.423491448164 , 0.694176703691 , -0.063583701849 , 
-0.0537109375 , 0.4189453125 , 0.6982421875 , -0.0634765625 , 
-0.0533317029476 , 0.414397269487 , 0.702294319868 , -0.0633598864079 , 
-0.052946805954 , 0.40984749794 , 0.706332921982 , -0.0632336139679 , 
-0.0525563061237 , 0.405296176672 , 0.710357815027 , -0.0630976855755 , 
-0.0521602630615 , 0.400743484497 , 0.71436882019 , -0.062952041626 , 
-0.051758736372 , 0.396189600229 , 0.718365758657 , -0.0627966225147 , 
-0.0513517856598 , 0.391634702682 , 0.722348451614 , -0.0626313686371 , 
-0.0509394705296 , 0.387078970671 , 0.726316720247 , -0.0624562203884 , 
-0.0505218505859 , 0.382522583008 , 0.730270385742 , -0.0622711181641 , 
-0.0500989854336 , 0.377965718508 , 0.734209269285 , -0.0620760023594 , 
-0.0496709346771 , 0.373408555984 , 0.738133192062 , -0.0618708133698 , 
-0.0492377579212 , 0.368851274252 , 0.74204197526 , -0.0616554915905 , 
-0.0487995147705 , 0.364294052124 , 0.745935440063 , -0.061429977417 , 
-0.0483562648296 , 0.359737068415 , 0.74981340766 , -0.0611942112446 , 
-0.0479080677032 , 0.355180501938 , 0.753675699234 , -0.0609481334686 , 
-0.047454982996 , 0.350624531507 , 0.757522135973 , -0.0606916844845 , 
-0.0469970703125 , 0.346069335938 , 0.761352539063 , -0.0604248046875 , 
-0.0465343892574 , 0.341515094042 , 0.765166729689 , -0.060147434473 , 
-0.0460669994354 , 0.336961984634 , 0.768964529037 , -0.0598595142365 , 
-0.0455949604511 , 0.332410186529 , 0.772745758295 , -0.0595609843731 , 
-0.0451183319092 , 0.32785987854 , 0.776510238647 , -0.0592517852783 , 
-0.0446371734142 , 0.323311239481 , 0.780257791281 , -0.0589318573475 , 
-0.0441515445709 , 0.318764448166 , 0.783988237381 , -0.058601140976 , 
-0.0436615049839 , 0.314219683409 , 0.787701398134 , -0.0582595765591 , 
-0.0431671142578 , 0.309677124023 , 0.791397094727 , -0.0579071044922 , 
-0.0426684319973 , 0.305136948824 , 0.795075148344 , -0.0575436651707 , 
-0.042165517807 , 0.300599336624 , 0.798735380173 , -0.0571691989899 , 
-0.0416584312916 , 0.296064466238 , 0.802377611399 , -0.0567836463451 , 
-0.0411472320557 , 0.291532516479 , 0.806001663208 , -0.0563869476318 , 
-0.0406319797039 , 0.287003666162 , 0.809607356787 , -0.0559790432453 , 
-0.0401127338409 , 0.282478094101 , 0.813194513321 , -0.0555598735809 , 
-0.0395895540714 , 0.277955979109 , 0.816762953997 , -0.055129379034 , 
-0.0390625 , 0.2734375 , 0.8203125 , -0.0546875 , 
-0.0385316312313 , 0.268922835588 , 0.823842972517 , -0.0542341768742 , 
-0.03799700737 , 0.264412164688 , 0.827354192734 , -0.0537693500519 , 
-0.0374586880207 , 0.259905666113 , 0.830845981836 , -0.0532929599285 , 
-0.0369167327881 , 0.255403518677 , 0.834318161011 , -0.0528049468994 , 
-0.0363712012768 , 0.250905901194 , 0.837770551443 , -0.0523052513599 , 
-0.0358221530914 , 0.246412992477 , 0.841202974319 , -0.0517938137054 , 
-0.0352696478367 , 0.241924971342 , 0.844615250826 , -0.0512705743313 , 
-0.0347137451172 , 0.237442016602 , 0.848007202148 , -0.0507354736328 , 
-0.0341545045376 , 0.23296430707 , 0.851378649473 , -0.0501884520054 , 
-0.0335919857025 , 0.228492021561 , 0.854729413986 , -0.0496294498444 , 
-0.0330262482166 , 0.224025338888 , 0.858059316874 , -0.0490584075451 , 
-0.0324573516846 , 0.219564437866 , 0.861368179321 , -0.0484752655029 , 
-0.031885355711 , 0.215109497309 , 0.864655822515 , -0.0478799641132 , 
-0.0313103199005 , 0.21066069603 , 0.867922067642 , -0.0472724437714 , 
-0.0307323038578 , 0.206218212843 , 0.871166735888 , -0.0466526448727 , 
-0.0301513671875 , 0.201782226563 , 0.874389648438 , -0.0460205078125 , 
-0.0295675694942 , 0.197352916002 , 0.877590626478 , -0.0453759729862 , 
-0.0289809703827 , 0.192930459976 , 0.880769491196 , -0.0447189807892 , 
-0.0283916294575 , 0.188515037298 , 0.883926063776 , -0.0440494716167 , 
-0.0277996063232 , 0.184106826782 , 0.887060165405 , -0.0433673858643 , 
-0.0272049605846 , 0.179706007242 , 0.89017161727 , -0.0426726639271 , 
-0.0266077518463 , 0.175312757492 , 0.893260240555 , -0.0419652462006 , 
-0.0260080397129 , 0.170927256346 , 0.896325856447 , -0.0412450730801 , 
-0.0254058837891 , 0.166549682617 , 0.899368286133 , -0.0405120849609 , 
-0.0248013436794 , 0.16218021512 , 0.902387350798 , -0.0397662222385 , 
-0.0241944789886 , 0.157819032669 , 0.905382871628 , -0.0390074253082 , 
-0.0235853493214 , 0.153466314077 , 0.908354669809 , -0.0382356345654 , 
-0.0229740142822 , 0.149122238159 , 0.911302566528 , -0.0374507904053 , 
-0.0223605334759 , 0.144786983728 , 0.914226382971 , -0.0366528332233 , 
-0.021744966507 , 0.140460729599 , 0.917125940323 , -0.0358417034149 , 
-0.0211273729801 , 0.136143654585 , 0.920001059771 , -0.0350173413754 , 
-0.0205078125 , 0.1318359375 , 0.9228515625 , -0.0341796875 , 
-0.0198863446712 , 0.127537757158 , 0.925677269697 , -0.0333286821842 , 
-0.0192630290985 , 0.123249292374 , 0.928478002548 , -0.0324642658234 , 
-0.0186379253864 , 0.11897072196 , 0.931253582239 , -0.0315863788128 , 
-0.0180110931396 , 0.114702224731 , 0.934003829956 , -0.0306949615479 , 
-0.0173825919628 , 0.110443979502 , 0.936728566885 , -0.0297899544239 , 
-0.0167524814606 , 0.106196165085 , 0.939427614212 , -0.0288712978363 , 
-0.0161208212376 , 0.101958960295 , 0.942100793123 , -0.0279389321804 , 
-0.0154876708984 , 0.0977325439453 , 0.944747924805 , -0.0269927978516 , 
-0.0148530900478 , 0.0935170948505 , 0.947368830442 , -0.0260328352451 , 
-0.0142171382904 , 0.0893127918243 , 0.949963331223 , -0.0250589847565 , 
-0.0135798752308 , 0.0851198136806 , 0.952531248331 , -0.0240711867809 , 
-0.0129413604736 , 0.0809383392334 , 0.955072402954 , -0.0230693817139 , 
-0.0123016536236 , 0.0767685472965 , 0.957586616278 , -0.0220535099506 , 
-0.0116608142853 , 0.072610616684 , 0.960073709488 , -0.0210235118866 , 
-0.0110189020634 , 0.0684647262096 , 0.962533503771 , -0.0199793279171 , 
-0.0103759765625 , 0.0643310546875 , 0.964965820313 , -0.0189208984375 , 
-0.00973209738731 , 0.0602097809315 , 0.967370480299 , -0.0178481638432 , 
-0.00908732414246 , 0.0561010837555 , 0.969747304916 , -0.0167610645294 , 
-0.00844171643257 , 0.0520051419735 , 0.972096115351 , -0.0156595408916 , 
-0.0077953338623 , 0.0479221343994 , 0.974416732788 , -0.0145435333252 , 
-0.0071482360363 , 0.0438522398472 , 0.976708978415 , -0.0134129822254 , 
-0.0065004825592 , 0.0397956371307 , 0.978972673416 , -0.0122678279877 , 
-0.00585213303566 , 0.035752505064 , 0.981207638979 , -0.0111080110073 , 
-0.00520324707031 , 0.0317230224609 , 0.983413696289 , -0.00993347167969 , 
-0.00455388426781 , 0.0277073681355 , 0.985590666533 , -0.00874415040016 , 
-0.00390410423279 , 0.0237057209015 , 0.987738370895 , -0.00753998756409 , 
-0.0032539665699 , 0.019718259573 , 0.989856630564 , -0.00632092356682 , 
-0.00260353088379 , 0.0157451629639 , 0.991945266724 , -0.00508689880371 , 
-0.0019528567791 , 0.0117866098881 , 0.994004100561 , -0.00383785367012 , 
-0.00130200386047 , 0.00784277915955 , 0.996032953262 , -0.0025737285614 , 
-0.000651031732559 , 0.00391384959221 , 0.998031646013 , -0.00129446387291 , 
};

#define L_SHIFT 24
#define L_MASK 0xff

#elif TABLE_SIZE == 32
d_type Lagrange_table[32][4] = {
-0.0 , 1.0 , 0.0 , -0.0 , 
-0.00993347167969 , 0.983413696289 , 0.0317230224609 , -0.00520324707031 , 
-0.0189208984375 , 0.964965820313 , 0.0643310546875 , -0.0103759765625 , 
-0.0269927978516 , 0.944747924805 , 0.0977325439453 , -0.0154876708984 , 
-0.0341796875 , 0.9228515625 , 0.1318359375 , -0.0205078125 , 
-0.0405120849609 , 0.899368286133 , 0.166549682617 , -0.0254058837891 , 
-0.0460205078125 , 0.874389648438 , 0.201782226563 , -0.0301513671875 , 
-0.0507354736328 , 0.848007202148 , 0.237442016602 , -0.0347137451172 , 
-0.0546875 , 0.8203125 , 0.2734375 , -0.0390625 , 
-0.0579071044922 , 0.791397094727 , 0.309677124023 , -0.0431671142578 , 
-0.0604248046875 , 0.761352539063 , 0.346069335938 , -0.0469970703125 , 
-0.0622711181641 , 0.730270385742 , 0.382522583008 , -0.0505218505859 , 
-0.0634765625 , 0.6982421875 , 0.4189453125 , -0.0537109375 , 
-0.0640716552734 , 0.66535949707 , 0.45524597168 , -0.0565338134766 , 
-0.0640869140625 , 0.631713867188 , 0.491333007813 , -0.0589599609375 , 
-0.0635528564453 , 0.597396850586 , 0.527114868164 , -0.0609588623047 , 
-0.0625 , 0.5625 , 0.5625 , -0.0625 , 
-0.0609588623047 , 0.527114868164 , 0.597396850586 , -0.0635528564453 , 
-0.0589599609375 , 0.491333007813 , 0.631713867188 , -0.0640869140625 , 
-0.0565338134766 , 0.45524597168 , 0.66535949707 , -0.0640716552734 , 
-0.0537109375 , 0.4189453125 , 0.6982421875 , -0.0634765625 , 
-0.0505218505859 , 0.382522583008 , 0.730270385742 , -0.0622711181641 , 
-0.0469970703125 , 0.346069335938 , 0.761352539063 , -0.0604248046875 , 
-0.0431671142578 , 0.309677124023 , 0.791397094727 , -0.0579071044922 , 
-0.0390625 , 0.2734375 , 0.8203125 , -0.0546875 , 
-0.0347137451172 , 0.237442016602 , 0.848007202148 , -0.0507354736328 , 
-0.0301513671875 , 0.201782226563 , 0.874389648438 , -0.0460205078125 , 
-0.0254058837891 , 0.166549682617 , 0.899368286133 , -0.0405120849609 , 
-0.0205078125 , 0.1318359375 , 0.9228515625 , -0.0341796875 , 
-0.0154876708984 , 0.0977325439453 , 0.944747924805 , -0.0269927978516 , 
-0.0103759765625 , 0.0643310546875 , 0.964965820313 , -0.0189208984375 , 
-0.00520324707031 , 0.0317230224609 , 0.983413696289 , -0.00993347167969 , 
};

#define L_SHIFT 27
#define L_MASK 0x1f


#endif

int Large_interp_faster(
	  d_type d_os_sig_real[]
	, d_type d_os_sig_imag[]
	, int os_sig_len
	, Air_mid_la_para *p_Air_mid_la_para
	, d_type *d_out_sig_real
	, d_type *d_out_sig_imag
	, int *out_sig_len
	, d_type *d_out_fracst, int tx_rx_flag)
{
	int i = 0;
	int i_num;
	int i_resample_len;
	int i_frac;
	int new_idx_len;

	long l_num_tmp;
	long l_factor;
	long l_frac;
	long l_new_idx_a;
	
	d_type d_factor;
	if (os_sig_len > LARGE_INTERP_OS_SIG_LEN)
	{
		return 1;
	}

//	if (new_idx_len > LARGE_INTERP_NEW_IDX_LEN)
//	{
//		return 2;
//	}

	////////////////// added by GAO 20150802
	//Bug
	i_resample_len = floorf(os_sig_len*p_Air_mid_la_para->interp_factor);
	if (tx_rx_flag) d_factor = 1/p_Air_mid_la_para->interp_factor;
	else d_factor = p_Air_mid_la_para->interp_factor;
	
	//printf("new_idx_len %d\n",new_idx_len);
	///////////////////////////////////////
	
	//d_new_idx_a = p_Air_mid_la_para->fracst + d_factor;
	l_factor = d_factor*(d_type)0x100000000;
	l_new_idx_a = p_Air_mid_la_para->fracst*(d_type)0x100000000 + l_factor;
	l_num_tmp = l_new_idx_a >> 32;
		
	do 
	{
		i_frac = l_new_idx_a >> L_SHIFT;
		i_frac &= L_MASK;
		i_num = (int)l_num_tmp - 1;

		d_out_sig_real[i] = 
			  d_os_sig_real[i_num - 1] * Lagrange_table[i_frac][0]
			+ d_os_sig_real[i_num    ] * Lagrange_table[i_frac][1]
			+ d_os_sig_real[i_num + 1] * Lagrange_table[i_frac][2]
			+ d_os_sig_real[i_num + 2] * Lagrange_table[i_frac][3];
		d_out_sig_imag[i] = 
			  d_os_sig_imag[i_num - 1] * Lagrange_table[i_frac][0]
			+ d_os_sig_imag[i_num    ] * Lagrange_table[i_frac][1]
			+ d_os_sig_imag[i_num + 1] * Lagrange_table[i_frac][2]
			+ d_os_sig_imag[i_num + 2] * Lagrange_table[i_frac][3];

		
		l_new_idx_a += l_factor;
		i++;
		l_num_tmp = l_new_idx_a >> 32;
		
	} while( l_num_tmp < (os_sig_len-1));
	
	new_idx_len = i;
	*d_out_fracst = (d_type)(l_new_idx_a - l_factor)/(d_type)0x100000000 - (d_type)os_sig_len + 4.;
	*out_sig_len = new_idx_len;

	return 0;
}
